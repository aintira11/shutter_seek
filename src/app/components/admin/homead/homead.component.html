<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div class="admin-container">
        <header class="admin-header">
            <div class="admin-profile">
              <img class="profile-avatar" [src]="datauser[0].image_profile" alt="Admin Profile" title="{{datauser[0].username}}" (click)="profile()"/>
              <span class="profile-name">{{ datauser[0].username }}</span>
              <button class="add-btn" (click)="goToadd()">+</button>
            </div>
          
            <div class="logo-center" (click)="gotohome()">
              <img  src="/assets/images/PIXEL (8).png" alt="Shutter Seek Logo" class="center-logo" />
            </div>
          
            <button class="logout-btn" (click)="logout()">ออกจากระบบ</button>
          </header>          
          
        <h1 >ผู้ดูแลระบบ</h1>
    
        <!--search-container -->
<div class="search-container">
    <input 
        type="text" 
        placeholder="ชื่อผู้ใช้ | อีเมลล์ | เบอร์โทร" 
        [(ngModel)]="searchKeyword"
        (keypress)="onSearchKeyPress($event)"
        (input)="searchUsers()"
    />
    <button class="button" (click)="searchUsers()">
        <i class="fa fa-search"></i>
    </button>
    <!-- เพิ่มปุ่มล้างการค้นหา -->
    <button class="button clear-btn" *ngIf="isSearching" (click)="clearSearch()" title="ล้างการค้นหา">
        <i class="fa fa-times"></i>
    </button>
    
    <div class="button-group">
        <button class="pushable" (click)="openCategoryModal()">
            <span class="shadow"></span>
            <span class="edge"></span>
            <span class="front">ประเภทที่เลือก</span>
        </button>
        <button class="pushable pushable-approve" (click)="goToConfirmShutter()">
            <span class="shadow"></span>
            <span class="edge"></span>
            <span class="front"> อนุมัติช่างภาพ </span>
        </button>                  
    </div>
</div>
    
<!-- แก้ไขส่วน tabs เพื่อแสดงสถานะการค้นหา -->
<div class="tabs">
  <button (click)="filterUsers(0)" [class.active]="selectedTab === 'all'" [class.searching]="isSearching">
    {{ isSearching ? 'ผลการค้นหา' : 'ทั้งหมด' }} ({{ datafilterUsers.length }})
  </button>
  <button (click)="filterUsers(3)" [class.active]="selectedTab === 'ผู้ดูแลระบบ'" [disabled]="isSearching">
    ผู้ดูแลระบบ({{ adminCount }})
  </button>
  <button (click)="filterUsers(1)" [class.active]="selectedTab === 'สมาชิก'" [disabled]="isSearching">
    สมาชิก ({{ memberCount }})
  </button>
  <button (click)="filterUsers(2)" [class.active]="selectedTab === 'ช่างภาพ'" [disabled]="isSearching">
    ช่างภาพ ({{ photographerCount }})
  </button>
  <button (click)="filterUsers(4)" [class.active]="selectedTab === 'บัญชีคู่'" [disabled]="isSearching">
    บัญชีคู่ ({{ MandP }})
  </button>
</div>
    
        <div class="user-list">
            <div *ngFor="let user of datafilterUsers" class="user-card">
                <img [src]="user.image_profile" alt="User Avatar" class="avatar" />
                <div class="user-info">
                    <h3>{{ user.username }}</h3>
                    <p class="role" *ngIf="user.type_user == '1'">ผู้ใช้ทั่วไป</p>
                    <p class="role" *ngIf="user.type_user == '2'">ช่างภาพ</p>
                    <p class="role" *ngIf="user.type_user == '3'">แอดมิน</p>
                    <p class="role" *ngIf="user.type_user == '4'">ช่างภาพ และ ผู้ใช้ทั่วไป</p>
                </div>

                <div class="actions">
                    <button *ngIf="user.type_user === '2' || user.type_user === '4' " class="report-btn" (click)="openReportDialog(user.user_id,user.username)">รายงาน ({{user.report_count}})</button>
                    <button class="detail-btn">รายละเอียด</button>
                    <button class="delete-btn" (click)="deleteUser(user.user_id)">
                        <i class="fa fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>  

        <!-- Modal แก้ไขประเภทงาน -->
        <div class="modal" *ngIf="isCategoryModal">
            <div class="modal-content">
                <p>แก้ไขประเภทงาน</p>
                <hr />
                <div class="category-list">
                    <div *ngFor="let category of jobCategories; let i = index" class="category-item">
                        <input [(ngModel)]="jobCategories[i].name_tags" type="text" [readonly]="!isEditing[i]" />
                        <button class="edit-btn" *ngIf="!isEditing[i]" (click)="enableEditing(i)">แก้ไข</button>
                        <button class="save-btn" *ngIf="isEditing[i]" (click)="saveEdit(i)">บันทึก</button>
                    </div>
                    <div class="category-item">
                        <input [(ngModel)]="newCategory" type="text" placeholder="เพิ่มประเภทใหม่" />
                        <button class="addd-btn" (click)="addCategory()">เพิ่ม</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="close-btn" (click)="closeCategoryModal()">ปิด</button>
                </div>
            </div>
        </div>

        <!-- Modal รายงาน -->
        <div class="modal" *ngIf="isModal">
            <div class="modal-content">
            <h2>ชื่อผู้ใช้ : <strong>{{ sht_username }}</strong></h2>
            <hr />
            <p>รายงานทั้งหมด {{ dataReport.length }} รายการ</p>
            <div class="report-list"*ngIf="dataReport.length > 0">
                <div *ngFor="let report of dataReport" class="report-item">
                <strong>{{ report.reporter_username }}  | เหตุผล : {{report.reason}}</strong>
                <p>{{ report.details }}</p>
                </div>
            </div>
            <div class="modal-actions">
                <button class="close-btn" (click)="closeModal()">ปิด</button>
            </div>
            </div>
        </div>
   </div>
</body>
</html>